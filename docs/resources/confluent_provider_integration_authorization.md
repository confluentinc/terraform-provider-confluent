---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "confluent_provider_integration_authorization Resource - terraform-provider-confluent"
subcategory: ""
description: |-
  
---

# confluent_provider_integration_authorization Resource

[![General Availability](https://img.shields.io/badge/Lifecycle%20Stage-General%20Availability-%2345c6e8)](https://docs.confluent.io/cloud/current/api.html#section/Versioning/API-Lifecycle-Policy)

`confluent_provider_integration_authorization` configures and validates a Cloud Service Provider (CSP) integration created by `confluent_provider_integration_setup`. This resource transitions the integration from DRAFT to CREATED status and validates the cloud provider setup.

-> **Note:** This resource will show persistent warnings until the cloud provider setup is complete. For Azure, you must grant admin consent and create a service principal. For GCP, you must configure IAM permissions.

## Example Usage

### Azure Provider Integration Authorization

You have two options to complete the Azure setup after creating the authorization resource:

#### Option 1: Using Azure Terraform Provider (Recommended for Infrastructure as Code)

```terraform
# Configure required providers
terraform {
  required_providers {
    confluent = {
      source = "confluentinc/confluent"
    }
    azuread = {
      source = "hashicorp/azuread"
    }
  }
}

resource "confluent_provider_integration_setup" "azure" {
  environment {
    id = var.environment_id
  }
  
  display_name = "azure-integration"
  cloud        = "AZURE"
}

resource "confluent_provider_integration_authorization" "azure" {
  provider_integration_id = confluent_provider_integration_setup.azure.id
  
  environment {
    id = var.environment_id
  }
  
  azure {
    customer_azure_tenant_id = var.azure_tenant_id
  }
}

# Automatically create the service principal using Azure Terraform Provider
resource "azuread_service_principal" "confluent" {
  client_id = confluent_provider_integration_authorization.azure.azure[0].confluent_multi_tenant_app_id
}

# Output the setup information
output "azure_app_id" {
  description = "Multi-tenant App ID for Azure setup"
  value       = confluent_provider_integration_authorization.azure.azure[0].confluent_multi_tenant_app_id
}

output "service_principal_object_id" {
  description = "Azure service principal object ID"
  value       = azuread_service_principal.confluent.object_id
}
```

#### Option 2: Using Azure CLI Commands

```terraform
resource "confluent_provider_integration_setup" "azure" {
  environment {
    id = var.environment_id
  }
  
  display_name = "azure-integration"
  cloud        = "AZURE"
}

resource "confluent_provider_integration_authorization" "azure" {
  provider_integration_id = confluent_provider_integration_setup.azure.id
  
  environment {
    id = var.environment_id
  }
  
  azure {
    customer_azure_tenant_id = var.azure_tenant_id
  }
}

# Output CLI commands for manual setup
output "azure_setup_command" {
  description = "Azure CLI command to create the service principal"
  value       = "az ad sp create --id ${confluent_provider_integration_authorization.azure.azure[0].confluent_multi_tenant_app_id}"
}
```

### GCP Provider Integration Authorization

You have two options to complete the GCP setup after creating the authorization resource:

#### Option 1: Using Google Terraform Provider (Recommended for Infrastructure as Code)

```terraform
# Configure required providers
terraform {
  required_providers {
    confluent = {
      source = "confluentinc/confluent"
    }
    google = {
      source = "hashicorp/google"
    }
  }
}

resource "confluent_provider_integration_setup" "gcp" {
  environment {
    id = var.environment_id
  }
  
  display_name = "gcp-integration"
  cloud        = "GCP"
}

resource "confluent_provider_integration_authorization" "gcp" {
  provider_integration_id = confluent_provider_integration_setup.gcp.id
  
  environment {
    id = var.environment_id
  }
  
  gcp {
    customer_google_service_account = var.gcp_service_account
  }
}

# Grant IAM permissions using Google Terraform Provider
resource "google_project_iam_member" "confluent_token_creator" {
  project = var.gcp_project_id
  role    = "roles/iam.serviceAccountTokenCreator"
  member  = "serviceAccount:${confluent_provider_integration_authorization.gcp.gcp[0].google_service_account}"
  
  condition {
    title       = "Confluent Cloud Access"
    description = "Allow Confluent Cloud to impersonate the customer service account"
    expression  = "request.auth.claims.sub == '${confluent_provider_integration_authorization.gcp.gcp[0].google_service_account}'"
  }
}

# Output the setup information
output "confluent_service_account" {
  description = "Confluent service account for GCP IAM setup"
  value       = confluent_provider_integration_authorization.gcp.gcp[0].google_service_account
}
```

#### Option 2: Using gcloud CLI Commands

```terraform
resource "confluent_provider_integration_setup" "gcp" {
  environment {
    id = var.environment_id
  }
  
  display_name = "gcp-integration"
  cloud        = "GCP"
}

resource "confluent_provider_integration_authorization" "gcp" {
  provider_integration_id = confluent_provider_integration_setup.gcp.id
  
  environment {
    id = var.environment_id
  }
  
  gcp {
    customer_google_service_account = var.gcp_service_account
  }
}

# Output gcloud commands for manual setup
output "gcp_iam_command" {
  description = "gcloud command to grant IAM permissions"
  value       = "gcloud projects add-iam-policy-binding YOUR_PROJECT_ID --member=\"serviceAccount:${confluent_provider_integration_authorization.gcp.gcp[0].google_service_account}\" --role=\"roles/iam.serviceAccountTokenCreator\" --condition=\"expression=request.auth.claims.sub=='${confluent_provider_integration_authorization.gcp.gcp[0].google_service_account}'\""
}

output "confluent_service_account" {
  description = "Confluent service account for GCP IAM setup"
  value       = confluent_provider_integration_authorization.gcp.gcp[0].google_service_account
}
```

## Azure Setup Process

After applying the Terraform configuration, complete the Azure setup:

1. **Get the multi-tenant app ID** from the Terraform outputs
2. **Grant admin consent** (if you have Global Admin rights):
   ```
   https://login.microsoftonline.com/{tenant-id}/adminconsent?client_id={app-id}
   ```
3. **Create the service principal**:
   ```bash
   az ad sp create --id {app-id}
   ```
4. **Grant permissions** in Azure Portal â†’ Enterprise Applications
5. **Re-run `terraform apply`** to validate the connection

## GCP Setup Process

After applying the Terraform configuration, complete the GCP setup:

1. **Get the Confluent service account** from the Terraform outputs
2. **Grant IAM permissions** in GCP Console:
   - Grant the Confluent service account "Service Account Token Creator" role on your service account
   - Grant your service account the necessary permissions (e.g., BigQuery Data Editor)
3. **Re-run `terraform apply`** to validate the connection

<!-- schema generated by tfplugindocs -->
## Argument Reference

The following arguments are supported:

- `provider_integration_id` - (Required String) The ID of the provider integration to authorize.
- `environment` - (Required Configuration Block) supports the following:
    - `id` - (Required String) The ID of the Environment that the Provider Integration belongs to, for example, `env-abc123`.
- `azure` - (Optional Configuration Block) Azure-specific configuration. Required for Azure integrations. It supports the following:
    - `customer_azure_tenant_id` - (Required String) Customer's Azure Tenant ID.
- `gcp` - (Optional Configuration Block) GCP-specific configuration. Required for GCP integrations. It supports the following:
    - `customer_google_service_account` - (Required String) Customer's Google Service Account that Confluent Cloud impersonates.

-> **Note:** Exactly one of `azure` or `gcp` configuration blocks must be provided, matching the cloud provider of the associated provider integration.

## Attributes Reference

In addition to the preceding arguments, the following attributes are exported:

- `id` - (Required String) The ID of the Provider Integration Authorization, for example, `cspi-4xg0q`.
- `azure` - (Optional Configuration Block) Azure-specific configuration details. It supports the following:
    - `confluent_multi_tenant_app_id` - (Computed String) Confluent Multi-Tenant App ID used to access customer Azure resources.
- `gcp` - (Optional Configuration Block) GCP-specific configuration details. It supports the following:
    - `google_service_account` - (Computed String) Google Service Account that Confluent Cloud uses for impersonation.

## Import

-> **Note:** `CONFLUENT_CLOUD_API_KEY` and `CONFLUENT_CLOUD_API_SECRET` environment variables must be set before importing a Provider Integration Authorization.

You can import a Provider Integration Authorization by using Environment ID and Provider Integration ID, in the format `<Environment ID>/<Provider Integration ID>`. The following example shows how to import a Provider Integration Authorization:

```shell
$ export CONFLUENT_CLOUD_API_KEY="<cloud_api_key>"
$ export CONFLUENT_CLOUD_API_SECRET="<cloud_api_secret>"
$ terraform import confluent_provider_integration_authorization.main env-abc123/cspi-4xg0q
```

!> **Warning:** Do not forget to delete terminal command history afterwards for security purposes.

## Getting Started

The following end-to-end examples might help to get started with `confluent_provider_integration_authorization` resource:
* [provider-integration-azure](https://github.com/confluentinc/terraform-provider-confluent/tree/master/examples/configurations/provider-integration-azure): Complete Azure Provider Integration setup
* [provider-integration-gcp](https://github.com/confluentinc/terraform-provider-confluent/tree/master/examples/configurations/provider-integration-gcp): Complete GCP Provider Integration setup